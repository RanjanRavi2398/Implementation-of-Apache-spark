{"version":"NotebookV1","origId":4259324615413843,"name":"01_create_aggregate_sample","language":"python","commands":[{"version":"CommandV1","origId":4259324615413844,"guid":"cbe92bb8-2b34-420c-8413-92e77e8f7457","subtype":"command","commandType":"auto","position":1.0,"command":"\n%md-sandbox\n\n<div style=\"text-align: center; line-height: 0; padding-top: 9px;\">\n  <img src=\"https://databricks.com/wp-content/uploads/2018/03/db-academy-rgb-1200px.png\" alt=\"Databricks Learning\" style=\"width: 600px\">\n</div>","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"78019eec-b7c3-46c3-9ee5-42f1fe4c42bc"},{"version":"CommandV1","origId":4259324615413845,"guid":"648ec0e3-4f22-45fd-a39a-4b438c2d5c44","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n# Create Aggregate Sample Data","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5e8aa7d6-18a6-4158-856c-2f4310da139e"},{"version":"CommandV1","origId":4259324615413846,"guid":"dcb60619-a64c-4424-8c34-2c0e7da55644","subtype":"command","commandType":"auto","position":3.0,"command":"%md\n## Configuration","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1f5c887e-a234-460a-9be5-587173d39fbf"},{"version":"CommandV1","origId":4259324615413847,"guid":"7ac5ceee-19e5-439b-9c94-5f14801f4ab1","subtype":"command","commandType":"auto","position":4.0,"command":"%run ./includes/configuration","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"73276273-111e-4be2-a008-951a80e20581"},{"version":"CommandV1","origId":4259324615413848,"guid":"66363cf9-1405-4514-a914-deeffe1a07ed","subtype":"command","commandType":"auto","position":5.0,"command":"%md\n## Define Spark References to Data\n\nIn the next cell, we use Apache Spark to define a reference to the data\nwe will be working with.\n\nWe need to create references to the following Delta tables:\n\n- `user_profile_data`\n- `health_profile_data`\n\n\uD83D\uDEE0 **Note:** Because we are working in Databricks, `spark`, a reference to the\nSpark Session on the cluster we are working with, is already available to us.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e6b28c0c-5f16-4b16-96d1-2463bcee61ae"},{"version":"CommandV1","origId":4259324615413849,"guid":"bbec2f03-4fa8-4728-b1e0-23de6dd289c2","subtype":"command","commandType":"auto","position":6.0,"command":"# ANSWER\n# Use spark.read to create references to the two tables as dataframes\n\nuser_profile_df = spark.read.table(\"user_profile_data\")\nhealth_profile_df = spark.read.table(\"health_profile_data\")","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e1d37732-7fc6-4176-b59f-9cff1dae5c5d"},{"version":"CommandV1","origId":4259324615413850,"guid":"5766d475-d4f5-4599-9431-17efe83f95bf","subtype":"command","commandType":"auto","position":7.0,"command":"%md\n### Data Schema\n\nUse Apache Spark to display the schemas of the data.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"62239522-c912-476a-800d-271a5ef8db8e"},{"version":"CommandV1","origId":4259324615413851,"guid":"a65ed4b4-aebc-4dff-9af4-a71629c37b97","subtype":"command","commandType":"auto","position":8.0,"command":"# ANSWER\nprint(\"User Profile Data\")\nuser_profile_df.printSchema()\nprint(\"Health Profile Data\")\nhealth_profile_df.printSchema()","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"acfcfb57-5b33-4e22-a2ff-84c0384298dc"},{"version":"CommandV1","origId":4259324615413852,"guid":"c4026a0e-24aa-4edf-8d43-058c873e078e","subtype":"command","commandType":"auto","position":9.0,"command":"%md\n### Display the Count of the User Profile Data","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"eb216fcb-98b5-40d1-b066-6e716be0f2c7"},{"version":"CommandV1","origId":4259324615413853,"guid":"f20bcd31-8143-4801-b9c0-334ac606683b","subtype":"command","commandType":"auto","position":10.0,"command":"user_profile_df.count()","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"330e96ea-e1bd-4470-8e26-2f109e9cb664"},{"version":"CommandV1","origId":4259324615413854,"guid":"4e35da95-2734-4879-9949-bafad5a9cbb8","subtype":"command","commandType":"auto","position":11.0,"command":"%md\n### Display the Minimum and Maximum Dates In the Health Profile Data","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"02df724e-945f-48c1-bc80-145098b04278"},{"version":"CommandV1","origId":4259324615413855,"guid":"b56d654d-5350-406a-997e-2f5ce2f64ba8","subtype":"command","commandType":"auto","position":12.0,"command":"# ANSWER\nfrom pyspark.sql.functions import min, max\n\ndisplay(\n  health_profile_df.select(min(\"dte\"), max(\"dte\"))\n)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"474.16375732421875","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"19cfd494-a870-41ef-b30c-852656f1be2e"},{"version":"CommandV1","origId":4259324615413856,"guid":"48b5f0e2-3758-4aa9-ba9a-530f2ebeeb8f","subtype":"command","commandType":"auto","position":13.0,"command":"%md\n### Display the Distinct Lifestyles in the User Profile Data","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c7fa1602-6539-4fa0-909f-773c4f87f82a"},{"version":"CommandV1","origId":4259324615413857,"guid":"4f536ba0-1654-4e5c-becd-365aeb7fc89e","subtype":"command","commandType":"auto","position":14.0,"command":"display(user_profile_df.select(\"lifestyle\").distinct())","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"155.0248565673828","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"308bfbe8-f0c6-4978-8090-8e0ab6567851"},{"version":"CommandV1","origId":4259324615413858,"guid":"1ebc1aaa-f9cf-49b3-8a37-24178d6f4e6c","subtype":"command","commandType":"auto","position":15.0,"command":"%md\n### Generate a Sample of Users","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"81d0daff-0cf8-4835-93e5-6e2180d3eb57"},{"version":"CommandV1","origId":4259324615413859,"guid":"4e5a744b-0e9b-43f9-9624-cfc04d8e258e","subtype":"command","commandType":"auto","position":16.0,"command":"user_profile_sample_df = user_profile_df.sample(0.03)\n\ndisplay(user_profile_sample_df.groupby(\"lifestyle\").count())","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"255.0248565673828","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"9e55bcbc-b470-4c1e-a59d-c441823087a6"},{"version":"CommandV1","origId":4259324615413860,"guid":"1e77f63a-21f7-4474-8b3b-3b64e7819818","subtype":"command","commandType":"auto","position":17.0,"command":"%md\n### Join the User Profile Data to the Health Profile Data\n\nPerform the join using the `_id` column.\n\nIf successful, You should have 365 times as many rows as are in the user sample.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e8638076-40c4-4466-8db3-179ca6b3cf51"},{"version":"CommandV1","origId":4259324615413861,"guid":"13a85997-4cc5-473a-91c5-71d1e083150b","subtype":"command","commandType":"auto","position":18.0,"command":"# ANSWER\nhealth_profile_sample_df = (\n  user_profile_sample_df\n  .join(health_profile_df, \"_id\")\n)\n\nassert 365*user_profile_sample_df.count() == health_profile_sample_df.count()","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f1e8a041-efea-49b4-80c8-61ae6384f8b9"},{"version":"CommandV1","origId":4259324615413862,"guid":"342fb443-db2f-4829-8505-506ac27a49f1","subtype":"command","commandType":"auto","position":19.0,"command":"%md\n### Display the User Profile Sample","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"408830c6-bc6a-4667-a7aa-173af1bbf747"},{"version":"CommandV1","origId":4259324615413863,"guid":"7ffb1cb3-2b4b-4cab-b0ba-19b48c78bc1a","subtype":"command","commandType":"auto","position":20.0,"command":"display(health_profile_sample_df)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"1858.4320526123047","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6d0c467e-c8c7-43ae-8bd6-fdaebbba8cf4"},{"version":"CommandV1","origId":4259324615413864,"guid":"bafa4eee-7b18-4424-8ac1-807c6266f2da","subtype":"command","commandType":"auto","position":21.0,"command":"%md\n## Aggregate the Data and Store It as an Aggregate Table\n\nYou should perform the following aggregations:\n\n- mean `BMI` aliased to `mean_BMI`\n- mean `active_heartrate` aliased to `mean_active_heartrate`\n- mean `resting_heartrate` aliased to `mean_resting_heartrate`\n- mean `VO2_max` aliased to `mean_VO2_max`","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a6266060-ac98-43f5-b3a5-97b3e73d6c86"},{"version":"CommandV1","origId":4259324615413865,"guid":"4dd26db1-05df-43de-ac0a-63eafc3d2c96","subtype":"command","commandType":"auto","position":22.0,"command":"# ANSWER\nfrom pyspark.sql.functions import mean, col\n\nhealth_tracker_sample_agg_df = (\n    health_profile_sample_df.groupBy(\"_id\", \"lifestyle\")\n    .agg(\n        mean(\"BMI\").alias(\"mean_BMI\"),\n        mean(\"active_heartrate\").alias(\"mean_active_heartrate\"),\n        mean(\"resting_heartrate\").alias(\"mean_resting_heartrate\"),\n        mean(\"VO2_max\").alias(\"mean_VO2_max\")\n    )\n)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ba1008f3-ba23-48d2-a9b3-ed7d75d773ec"},{"version":"CommandV1","origId":4259324615413866,"guid":"807b07dc-16a3-4c72-805c-25787a9309b2","subtype":"command","commandType":"auto","position":23.0,"command":"from pyspark.sql.types import _parse_datatype_string\n\naggregate_schema = \"\"\"\n  _id string,\n  lifestyle string,\n  mean_BMI double,\n  mean_active_heartrate double,\n  mean_resting_heartrate double,\n  mean_VO2_max double\n\"\"\"\n\nassert health_tracker_sample_agg_df.schema == _parse_datatype_string(aggregate_schema)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"54845d1f-9d3d-49dd-ab86-22e03bd3d258"},{"version":"CommandV1","origId":4259324615413867,"guid":"cbf7ab22-c460-427e-8924-abb626959dfb","subtype":"command","commandType":"auto","position":24.0,"command":"%md\n### Write the Aggregation Dataframe to a Delta Table\n\nUse the following path: `goldPath + \"health_tracker_sample_agg\"`","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d166b73c-165d-4980-bd4a-033e537cef31"},{"version":"CommandV1","origId":4259324615413868,"guid":"e77bd2aa-9160-4e61-ac48-fd15509624d9","subtype":"command","commandType":"auto","position":25.0,"command":"# ANSWER\n(\n  health_tracker_sample_agg_df.write\n  .format(\"delta\")\n  .mode(\"overwrite\")\n  .save(goldPath + \"health_tracker_sample_agg\")\n)\n","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ff5b9559-d9e5-4679-8967-401cada4c5ae"},{"version":"CommandV1","origId":4259324615413869,"guid":"544a7d47-a4d3-4fde-9c57-31e45b0915c8","subtype":"command","commandType":"auto","position":26.0,"command":"%md-sandbox\n&copy; 2020 Databricks, Inc. All rights reserved.<br/>\nApache, Apache Spark, Spark and the Spark logo are trademarks of the <a href=\"http://www.apache.org/\">Apache Software Foundation</a>.<br/>\n<br/>\n<a href=\"https://databricks.com/privacy-policy\">Privacy Policy</a> | <a href=\"https://databricks.com/terms-of-use\">Terms of Use</a> | <a href=\"http://help.databricks.com/\">Support</a>","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"joshua.cook@databricks.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c4fec97f-63d8-4816-ae96-12c5e98003d5"}],"dashboards":[],"guid":"2df2e015-9bac-4598-beae-0b629e483284","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}