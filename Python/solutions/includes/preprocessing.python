{"version":"NotebookV1","origId":4259324615413993,"name":"preprocessing","language":"python","commands":[{"version":"CommandV1","origId":4259324615413994,"guid":"07fa61a8-7840-4311-9f39-bfca2868e0e2","subtype":"command","commandType":"auto","position":1.0,"command":"\n%md\n##### Load `health_tracker_sample_agg_pd_df` Pandas DataFrame","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"579109183679732","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2c436e7b-a8d8-4af9-866e-a589ca1cf813"},{"version":"CommandV1","origId":4259324615413995,"guid":"175412d6-3476-4d7d-9c21-a39040003a42","subtype":"command","commandType":"auto","position":2.0,"command":"health_tracker_sample_agg_pd_df = (\n  spark.read\n  .format(\"delta\")\n  .load(goldPath + \"health_tracker_sample_agg\")\n  .toPandas()\n)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"579109183679732","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ce503456-39a7-496e-aebd-19015461542c"},{"version":"CommandV1","origId":4259324615413996,"guid":"7597f225-4f11-4464-a7be-e8bf23aaa2e1","subtype":"command","commandType":"auto","position":3.0,"command":"%md\n### Load Scipy Libraries","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"579109183679732","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"17075977-86a9-4070-bd30-a968ac05595c"},{"version":"CommandV1","origId":4259324615413997,"guid":"b4900bc3-d09b-4171-86d2-d37e3681d1e0","subtype":"command","commandType":"auto","position":4.0,"command":"import matplotlib.pyplot as plt\nimport mlflow\nimport numpy as np\nimport pandas as pd\nimport seaborn as sns","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"579109183679732","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"3e375163-b5f9-42de-8d98-b3b673418b02"},{"version":"CommandV1","origId":4259324615413998,"guid":"346e06b2-214e-47a9-93ae-8da78dbc7330","subtype":"command","commandType":"auto","position":5.0,"command":"%md\n### Define Scipy Utility Functions","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"579109183679732","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7a0186f9-9c80-4d2c-93ff-f083b02de53a"},{"version":"CommandV1","origId":4259324615413999,"guid":"248a1d09-5e1c-4871-ab17-9c62bb8dde14","subtype":"command","commandType":"auto","position":6.0,"command":"%md\n###### `scatter_plot_with_decision_boundary(ax, features, target, model)`","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"579109183679732","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"000820ec-1159-4c3f-84bb-bf0e4bf67cc6"},{"version":"CommandV1","origId":4259324615414000,"guid":"b8a3ea0f-b056-4a0e-9816-b70905e78b6d","subtype":"command","commandType":"auto","position":7.0,"command":"def scatter_plot_with_decision_boundary(ax, features, target, model):\n    mesh_step_size = 1\n\n    x_min, x_max = features[0].min() - .5, features[0].max() + .5\n    y_min, y_max = features[1].min() - .5, features[1].max() + .5\n    xx, yy = np.meshgrid(\n      np.arange(x_min, x_max, mesh_step_size),\n      np.arange(y_min, y_max, mesh_step_size)\n    )\n    Z = model.predict(np.c_[xx.ravel(), yy.ravel()])\n\n    for color, lifestyle in zip(\n      (\"blue\", \"orange\", \"green\"),\n      ('weight trainer', 'cardio trainer', 'sedentary')):\n        two_dim_per_lifestyle = features[target.lifestyle == lifestyle]\n        two_dim_per_lifestyle.plot(x=0, y=1, kind=\"scatter\", c=color, label=lifestyle, ax=ax)\n    Z = Z.reshape(xx.shape)\n    ax.pcolormesh(xx, yy, Z, cmap=plt.cm.Paired, alpha=0.3)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"579109183679732","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2be32712-eddf-4616-b9c6-e1c86233d7f5"},{"version":"CommandV1","origId":4259324615414001,"guid":"f41ba255-86a6-4e3d-b670-ee02ddfb1e2d","subtype":"command","commandType":"auto","position":8.0,"command":"%md\n###### `generate_feature_subsets(df)`","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"579109183679732","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"85c12a22-c51e-40ed-9add-83f663dbc3b1"},{"version":"CommandV1","origId":4259324615414002,"guid":"2798154d-7bf4-411c-a945-a21438559be9","subtype":"command","commandType":"auto","position":9.0,"command":"from itertools import combinations\n\ndef generate_feature_subsets(df):\n  feature_columns = df.select_dtypes(exclude=[\"object\"]).columns\n  feature_subsets = []\n  for i in range(1, 5):\n    feature_subsets += [list(feat) for feat in combinations(feature_columns, i)]\n  return feature_subsets","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"579109183679732","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"09eac3d7-2cfa-4d28-aeb8-ad7a41be8649"},{"version":"CommandV1","origId":4259324615414003,"guid":"b7729bdd-18b5-4dc4-84a6-4228c9d1001c","subtype":"command","commandType":"auto","position":10.0,"command":"%md\n###### `generate_bootstrap_sample(df, lifestyles, n=5)`","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"579109183679732","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"57e6efb6-84a3-400a-9927-3dfe1c696152"},{"version":"CommandV1","origId":4259324615414004,"guid":"670e1858-1326-47e6-8df9-ce1aa9960273","subtype":"command","commandType":"auto","position":11.0,"command":"def generate_bootstrap_sample(df, lifestyles, n=5):\n  sample_df_list = []\n  for lifestyle in lifestyles:\n    sample_df_list.append(\n      df[df.lifestyle == lifestyle].sample(n, replace=True)\n    )\n  return pd.concat(sample_df_list)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"579109183679732","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0996d14a-9f30-4434-b377-216c94139fe7"},{"version":"CommandV1","origId":4259324615414005,"guid":"dcd2a829-a001-48be-9ed9-ce253dfa86fc","subtype":"command","commandType":"auto","position":12.0,"command":"%md\n###### `generate_subsample_sets(df, lifestyles)`","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"579109183679732","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"8baf7899-9e98-4e04-ba45-0b050cf3654f"},{"version":"CommandV1","origId":4259324615414006,"guid":"b9585088-7661-4e61-a5f0-e61867b9901c","subtype":"command","commandType":"auto","position":13.0,"command":"from sklearn.preprocessing import LabelEncoder\n\ndef generate_subsample_sets(df, lifestyles):\n  sample_sets = [generate_bootstrap_sample(df, lifestyles) for _ in range(10)]\n  le = LabelEncoder()\n  le.fit(df.lifestyle)\n\n  for sample_set in sample_sets:\n    sample_set[\"lifestyle_encoded\"] = le.transform(sample_set.lifestyle)\n\n  return sample_sets","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"579109183679732","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"bf55a298-84b9-4911-9505-0a6ef0512f0d"},{"version":"CommandV1","origId":4259324615414007,"guid":"6ed66a0e-a10a-47b3-9c8d-e0bf42cc376d","subtype":"command","commandType":"auto","position":14.0,"command":"%md\n###### `experiment_runner(feature_subset, model, param_grid={})`","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"579109183679732","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"61fc871b-9c58-4c07-a71f-d9c7beffab71"},{"version":"CommandV1","origId":4259324615414008,"guid":"11d83c9f-5a2d-4986-913c-8f420b1584e4","subtype":"command","commandType":"auto","position":15.0,"command":"from sklearn.model_selection import GridSearchCV\nfrom sklearn.tree import DecisionTreeClassifier\n\ndef experiment_runner(feature_subset, model, param_grid={}):\n  \"\"\"Helper function to run MLflow experiment on a feature subset.\"\"\"\n  with mlflow.start_run() as run:\n    \"Build Subsets of Features.\"\n    experimental_data_subsets = [\n        sample_set[feature_subset]\n        for sample_set in sample_sets\n    ]\n\n    targets = [\n      sample_set[\"lifestyle_encoded\"]\n      for sample_set in sample_sets\n    ]\n\n    \"Fit on each subset using LOO Cross-Validation.\"\n    experimental_scores = []\n    for features, target in zip(experimental_data_subsets, targets):\n      gs = GridSearchCV(model, param_grid=param_grid, cv=5)\n      gs.fit(features, target)\n      score = gs.cv_results_[\"mean_test_score\"][0]\n      experimental_scores.append(score)\n\n    \"Record experiment results.\"\n    mlflow.log_param(\"subset\", feature_subset)\n    model_name = (\n      str(model.__class__)\n      .split(\".\")[-1]\n      .replace(\"'>\",\"\")\n    )\n    mlflow.log_param(\"model\", model_name)\n    mlflow.log_metric(\"mean score\", np.mean(experimental_scores))\n    mlflow.log_metric(\"std score\", np.std(experimental_scores))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"579109183679732","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b70c5952-cdd2-485c-bdc6-cee9ba7aa683"},{"version":"CommandV1","origId":4259324615414009,"guid":"e65c3d4d-d22f-4255-9633-d9a92200518e","subtype":"command","commandType":"auto","position":16.0,"command":"%md\n###### `retrieve_results(metrics, params)`","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"579109183679732","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f1ed6725-3293-453b-acf0-9f740ebadf8a"},{"version":"CommandV1","origId":4259324615414010,"guid":"c7114d14-7e7f-4f46-b806-8d584b567373","subtype":"command","commandType":"auto","position":17.0,"command":"def retrieve_results(metrics, params):\n  results = mlflow.search_runs()\n  keys = []\n  for metric in metrics:\n    keys.append(\"metrics.\" + metric)\n  for param in params:\n    keys.append(\"params.\" + param)\n  results = results[keys]\n  results.dropna(inplace=True)\n  results.drop_duplicates(inplace=True)\n  return results\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"579109183679732","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e22ddf72-b431-40cd-b507-4774816ec294"}],"dashboards":[],"guid":"c4b9a4f9-7378-44b8-9047-d2b131874829","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}